# RandomUser

Тестовое приложение на базе API [https://randomuser.me](https://randomuser.me).

Приложение позволяет:
- создавать случайных пользователей по полу и национальности;
- просматривать детальную информацию о пользователе;
- видеть список всех созданных пользователей;
- работать с ранее созданными пользователями без интернета (кэширование в базе данных).

---

## Стек технологий

- **Язык**: Kotlin
- **UI**: Jetpack Compose, Material 3
- **Навигация**: Navigation Compose (Single Activity)
- **DI**: Hilt (+ KSP)
- **Работа с сетью**: Retrofit, OkHttp, Moshi
- **Хранение данных**: Room (SQLite)
- **Асинхронность**: Kotlin Coroutines, Flow
- **Загрузка изображений**: Coil 3
- **Тестирование**: JUnit4, `kotlinx-coroutines-test`

---

## Архитектура

Приложение разделено на три слоя, согласно требованиям:

- **data**
  - `RandomUserApi` – Retrofit-интерфейс для `https://randomuser.me/api/`.
  - DTO-модели ответа (`RandomUserResponseDto`, `UserDto`, …).
  - Room-слой (`UserEntity`, `UserDao`, `AppDatabase`).
  - Реализация репозитория `UserRepositoryImpl`.
  - Мапперы `UserDto → UserEntity → User`.

- **domain**
  - Доменная модель `User`.
  - Контракт `UserRepository`.
  - Use case-ы:
    - `GetRandomUserUseCase`
    - `GetUsersUseCase`
    - `GetUserByIdUseCase`
    - `DeleteUserUseCase`

- **presentation**
  - ViewModel-ы:
    - `CreateUserViewModel`
    - `UserListViewModel`
    - `UserDetailsViewModel`
  - Экраны на Compose:
    - `CreateUserScreen`
    - `UserListScreen`
    - `UserDetailsScreen`
  - Общий `UiState` для описания состояний экрана:
    `Idle / Loading / Success / Empty / Error`.
  - Навигация: `RandomUserNavGraph`, sealed-класс `Screen`.
  - Общие UI-компоненты: `RandomUserTopBar`, `UserListItem` и др.
  - Тема/стили: `RandomUserTheme`, `AppColors`, `AppTextStyles`.

---

## Экраны

### 1. Экран списка пользователей (главный)

- Показывает список всех ранее созданных пользователей из локальной базы (Room).
- Если список пуст:
  - отображается сообщение: _"You have not created any users yet"_;
  - сразу выполняется навигация на экран создания пользователя, чтобы пользователь не попадал в «пустой» UI.
- Каждый элемент списка содержит:
  - фото пользователя;
  - полное имя;
  - телефон;
  - флаг и код национальности;
  - меню с действием **Delete** (удаление пользователя из БД).

Это экран считается «главным»: на нём нет стрелки назад, в отличие от остальных экранов.

### 2. Экран создания пользователя

- Заголовок: `Generate User` со стрелкой назад.
- Два выпадающих списка:
  - **Select Gender** (`Any / Male / Female`) → передаётся в `gender` для API.
  - **Select Nationality** (список доступных `nat` согласно документации API).
- Кнопка **GENERATE** у нижнего края экрана.
- При нажатии:
  - показывается прогресс-индикатор;
  - выполняется запрос к `RandomUserApi`;
  - при успехе: пользователь сохраняется в Room, экран навигирует на `UserDetailsScreen`;
  - при ошибке: показывается текст ошибки внизу экрана.
- Состояние экрана описывается через `UiState<User>`.

### 3. Экран детализации пользователя

- Сверху – горизонтальный градиентный фон.
- В левом верхнем углу — стрелка назад в белом круге.
- Аватар пользователя расположен на границе градиента и белого фона.
- Ниже — приветственный текст и имя пользователя.
- Основной блок – карточка с табами:
  - **Общие данные**: имя, пол, возраст, дата рождения (парсинг из `dateOfBirth`).
  - **Телефоны**: `phone`, `cell`.
  - **Email**.
  - **Адрес**: страна, город, улица, полный адрес.

> Небольшое дизайнерское улучшение:  
> Цвет градиента зависит от пола пользователя — для мужчин используется «синий» градиент, для женщин — «розовый».

---

## Кэширование и работа офлайн

- Все созданные пользователи сохраняются в локальную базу данных (Room).
- Экран списка и детализации работают только с Room и продолжают корректно отображать данные в офлайне.
- При отсутствии интернета на экране создания пользователя запрос завершится ошибкой, и пользователь увидит понятное сообщение об ошибке, но приложение останется полностью рабочим для уже сохранённых пользователей.

---

## Обработка ошибок и пустых состояний

Для всех экранов используется единый тип состояния `UiState`:

- `Loading` – отображается `CircularProgressIndicator`.
- `Empty` – текст-подсказка пользователю (например, отсутствие пользователей или не найденный пользователь).
- `Error` – текст ошибки (например, ошибка сети или сервера).
- `Success` – успешная загрузка данных.
- `Idle` – начальное состояние там, где это имеет смысл (например, на экране создания пользователя до первого запроса).

---

## Интересные/нестандартные решения

- Главным экраном выбран **список пользователей**:
  - При первом запуске, когда список пуст, приложение автоматически перенаправляет на экран создания пользователя, так что пользователь всё равно первым видит выбор пола/национальности, как указано в задании.
  - При наличии уже созданных пользователей это даёт более привычный UX: сразу виден список, а новый пользователь создаётся через кнопку.
- Градиентная шапка на экране детализации зависит от пола пользователя (мужской/женский вариант).
- Использованы превью Compose (`@DevicePreviews`) для нескольких устройств и состояний (успех/ошибка/пусто), что упрощает визуальную проверку UI без запуска на девайсе.
- Для StateFlow в ViewModel-ах используется `SharingStarted.WhileSubscribed(5_000L)` – современный рекомендованный режим для UI-состояний.

---

## Тесты

В проекте присутствуют юнит-тесты для основных частей логики:

- ViewModel-ы:
  - `UserListViewModel` (обработка пустого списка, ненулевого списка, удаления пользователя).
  - `UserDetailsViewModel` (пользователь найден / не найден).
- Репозиторий / use case-ы (взаимодействие с API и Room).
- Вспомогательные функции (например, `natToFlagEmoji` → проверка корректного отображения флагов).

Для тестирования корутин используется `kotlinx-coroutines-test` и правило `MainDispatcherRule`.

---

## Сборка и запуск

1. Клонировать репозиторий или распаковать архив.
2. Открыть проект в Android Studio (Arctic Fox и новее).
3. Убедиться, что Gradle JDK выставлен не ниже Java 17.
4. Дождаться синхронизации Gradle.
5. Запустить конфигурацию `app` на эмуляторе или реальном устройстве.

---

## Возможные улучшения

- Вынести все строки в `strings.xml` для поддержки локализации (в продакшн так бы точно сделал).
- Использовать типизированные даты (`LocalDate` / `Instant`) для `dateOfBirth` и форматировать их в UI.
- Добавить UI-тесты на Compose для ключевых сценариев (создание пользователя, отображение списка и детализации).
- Реализовать drag-n-drop сортировку списка пользователей.
- Отображать разные приветствия на экране детализации.
